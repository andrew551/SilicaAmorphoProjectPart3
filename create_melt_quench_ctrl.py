import sys, os
import datetime
from pathlib import Path
import makeconfig

def create_melt_quench_ctrl(regularised_input_path, config):
    output_dir = config['output_dir']

    command = "# Annealing script for testing potentials\n"
    command += "#\n"
    command += "units           metal\n"
    command += "boundary        p p p\n"
    command += "#\n"
    command += "box tilt large\n"
    command += "#\n"
    command += "atom_style      atomic\n"
    command += "#\n"
    command += f"read_data       {regularised_input_path}\n"
    command += "#\n"
    command += makeconfig.get_potential_command(config)
    command += "#\n"
    command += "#neighbor        2 bin\n"
    command += f"dump myDump all custom 1 {output_dir}/annealing_temp.dump id type x y z vx vy vz\n"
    command += "dump_modify myDump format line \"%d %d %10.8e %10.8e %10.8e %10.8e %10.8e %10.8e\"\n"
    command += "\n"
    #command += "velocity all create 6000 4928459 rot yes dist gaussian\n"
    command += "timestep        0.0005\n"
    command += "thermo          10\n"
    command += "thermo_style    custom  step density temp press ke pe etotal\n"
    command += "#######################################################\n"
    command += "\n"
    command += "\n"
    command += "#read here https://docs.lammps.org/fix_nh.html\n"
    command += "                               #Tstart Tstop Tdamp\n"
    command += "                               #Tdamp must be 100 timesteps, see https://docs.lammps.org/fix_nh.html\n"
    #command += "dump h5md1 all xyz 100 dumps/dump_xyz position velocity"
    command += 'fix    npt1 all npt temp 300 3000 $(100.0*dt) iso 0.001 0.001 10\n'
    command += 'run 8000\n'
    command += 'fix    npt1 all npt temp 3000 3000 $(100.0*dt) aniso 0.001 0.001 10\n'
    command += 'run 200000\n'
    command += f"write_data      {output_dir}/1_randomisedxx.dat\n"
    '''
    command += "fix             F1 all npt temp 300.0 4000.0 $(100.0*dt) iso 0.0 0.0 10.0\n"
    command += "run             8000\n"
    command += "unfix           F1\n"
    command += f"write_data      {output_dir}/1_randomised.dat\n"
    command += "\n"
    command += "fix             F2 all npt temp 4000.0 4000.0 $(100.0*dt) iso 0.0 0.0 5.0\n"
    command += "run             20000\n"
    command += "unfix           F2\n"
    command += f"write_data      {output_dir}/2_melted.dat\n"
    command += "\n"

    command += "fix             F3 all npt temp 4000.0 3500.0 $(100.0*dt) iso 0.0 0.0 5.0\n"
    command += "run             1000000\n"
    command += "unfix           F3\n"
    command += f"write_data      {output_dir}/3_quench_4000_3500.dat\n"
    command += "\n"
    command += "fix             F4 all npt temp 3500.0 3000.0 $(100.0*dt) iso 0.0 0.0 5.0\n"
    command += "run             1000000\n"
    command += "unfix           F4\n"
    command += f"write_data      {output_dir}/4_quench_3500_3000.dat\n"
    command += "\n"
    command += "fix             F5 all npt temp 3000.0 2500.0 $(100.0*dt) iso 0.0 0.0 5.0\n"
    command += "run             1000000\n"
    command += "unfix           F5\n"
    command += f"write_data      {output_dir}/5_quench_3000_2500.dat\n"
    command += "\n"
    command += "fix             F6 all npt temp 2500.0 2000.0 $(100.0*dt) iso 0.0 0.0 5.0\n"
    command += "run             1000000\n"
    command += "unfix           F6\n"
    command += f"write_data      {output_dir}/6_quench_2500_2000.dat\n"
    command += "\n"
    command += "fix             F7 all npt temp 2000.0 1500.0 $(100.0*dt) iso 0.0 0.0 5.0\n"
    command += "run             1000000\n"
    command += "unfix           F7\n"
    command += f"write_data      {output_dir}/7_quench_2000_1500.dat\n"
    command += "\n"
    command += "fix             F8 all npt temp 1500.0 1000.0 $(100.0*dt) iso 0.0 0.0 5.0\n"
    command += "run             1000000\n"
    command += "unfix           F8\n"
    command += f"write_data      {output_dir}/8_quench_1500_1000.dat\n"
    command += "\n"
    command += "fix             F9 all npt temp 1000.0 500.0 $(100.0*dt) iso 0.0 0.0 5.0\n"
    command += "run             1000000\n"
    command += "unfix           F9\n"
    command += f"write_data      {output_dir}/9_quench_1000_500.dat\n"
    command += "\n"
    command += "fix             F10 all npt temp 500.0 300.0 $(100.0*dt) iso 0.0 0.0 5.0\n"
    command += "run             400000\n"
    command += "unfix           F10\n"
    command += f"write_data      {output_dir}/10_quench_500_300.dat\n"
    command += "\n"
    command += "fix             F11 all npt temp 300.0 300.0 $(100.0*dt) iso 0.0 0.0 5.0\n"
    command += "run             20000\n"
    command += "unfix           F11\n"
    command += f"write_data      {output_dir}/11_amorphous.dat\n"
    '''
    return command
